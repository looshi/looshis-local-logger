<!DOCTYPE html>
<html>
  <head>
    <title>LLL</title>
  </head>
  <style>
    :root {
      color-scheme: light dark;
      accent-color: #368d59;
      font-family: monospace, Arial, Helvetica, sans-serif;
      font-size: 14px;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      flex-wrap: nowrap;
    }

    header {
      flex-shrink: 0;
      height: 140px;
      padding: 20px;
    }

    main {
      flex-grow: 1;
      overflow: auto;
      min-height: 2em;
    }

    footer {
      flex-shrink: 0;
      height: 60px;
      display: flex;
      align-items: center;
      width: 100%;
      justify-content: space-between;
    }

    p {
      margin: 0;
      padding: 4px 20px;
    }
    div {
      margin: 16px 0;
      padding: 16px 20px;
      color: light-dark(#0f181a, #f3dcff);
      background-color: light-dark(#f7f6f6, #19151a);
      border-top: 1px solid #38313a;
      border-bottom: 1px solid #38313a;
      white-space: pre;
    }
    a {
      text-decoration: none;
    }
  </style>

  <body>
    <header></header>
    <main></main>
    <footer>
      <p id="status"></p>
      <p>
        <a
          href="https://github.com/looshi/looshis-local-logger"
          referrerpolicy="origin"
          target="_blank"
        >
          Looshi's Local Logger v2.0.0
        </a>
      </p>
    </footer>

    <script>
      const main = document.getElementsByTagName("main")[0];

      function addLog(log) {
        const msg = log
          .split("NEW_LINE_CHARACTER")
          .map((line) => {
            try {
              let obj = JSON.parse(line);
              if (typeof obj == "string") {
                obj = JSON.parse(obj); // If the json was double stringified, double parse
              }
              return JSON.stringify(obj, null, 2);
            } catch (e) {
              return line;
            }
          })
          .join("\n");

        const div = document.createElement("div");
        div.innerText = msg;
        main.prepend(div);
      }
      const status = document.getElementById("status");
      const es = new EventSource("http://localhost:{{port}}/events");

      es.addEventListener("open", (message) => {
        status.textContent = "Connected";
        status.setAttribute("style", "color: #60ba5d; ");
      });

      es.addEventListener("error", (message) => {
        status.textContent = "Not connected";
        status.setAttribute("style", "color: orange;");
      });

      es.addEventListener("message", (message) => {
        status.textContent = "Connected";
        addLog(message.data);
      });
    </script>
  </body>
</html>
