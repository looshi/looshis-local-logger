<html>

<head>
  <title>LLL</title>
</head>

<body style="background: #1c2023; color: #bfb5a9; font-family: Arial, Helvetica, sans-serif;margin:0;">
  <p id="status"></p>

  <script>
    const status = document.getElementById('status');
    const es = new EventSource('http://localhost:{{port}}/events');
    let eCount = 0;

    es.addEventListener('open', (message) => {
      status.textContent = "Connected";
      status.setAttribute('style', "color: lightgreen; border-top: 6px solid lightgreen;");
    });

    es.addEventListener('error', (message) => {
      status.textContent = "Not connected";
      status.setAttribute('style', "color: orange; border-top: 6px solid orange;");
    });

    es.addEventListener('message', (message) => {
      eCount = eCount + 1;
      status.textContent = `Connected, lines received: ${eCount}`;
      try {
        var obj = JSON.parse(message.data);
        if (typeof obj == 'string') {
          obj = JSON.parse(obj); // If the json was double stringified, double parse here
        }
        console.log(obj);
      } catch (e) {
        console.log(message.data);
      };
    })
  </script>
</body>

</html>
