<html>

<body style="background: aliceblue">
  <h1>Looshi's Local Logger</h1>
  <p id="status"></p>

  <script>
    const status = document.getElementById('status');
    const es = new EventSource('http://localhost:{{port}}/events');
    let eCount = 0;

    es.addEventListener('open', (message) => {
      status.textContent = "Connected";
      status.setAttribute('style', "background: lightgreen")
    });

    es.addEventListener('error', (message) => {
      status.textContent = "Not connected";
      status.setAttribute('style', "background: orange")
    });

    es.addEventListener('message', (message) => {
      eCount = eCount + 1;
      status.textContent = `Connected, ${eCount} events received`;
      try {
        var obj = JSON.parse(message.data);
        if (typeof obj == 'string') {
          obj = JSON.parse(obj); // If the json was double stringified, double parse here
        }
        console.log(obj);
      } catch (e) {
        console.log(message.data);
      };
    })
  </script>
</body>

</html>
